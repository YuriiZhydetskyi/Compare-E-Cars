<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –µ–ª–µ–∫—Ç—Ä–æ–º–æ–±—ñ–ª—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏ 2025</title>
    
    <!-- Tabulator CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.5.0/css/tabulator.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        label {
            font-weight: 600;
            color: #495057;
        }
        
        select, input[type="file"], button {
            padding: 8px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        select:focus, input[type="file"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        button.secondary {
            background: #6c757d;
        }
        
        button.secondary:hover {
            background: #5a6268;
        }
        
        button.danger {
            background: #dc3545;
        }
        
        button.danger:hover {
            background: #c82333;
        }
        
        #ev-table {
            margin: 0;
        }
        
        .tabulator {
            font-size: 14px;
        }
        
        .tabulator-col-title {
            font-weight: 600;
        }
        
        .positive-diff {
            color: #28a745;
            font-weight: 600;
        }
        
        .negative-diff {
            color: #dc3545;
            font-weight: 600;
        }
        
        .neutral-diff {
            color: #6c757d;
        }
        
        .base-model-row {
            background: #fff3cd !important;
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 18px;
        }
        
        .info-panel {
            padding: 20px 30px;
            background: #e7f3ff;
            border-top: 3px solid #667eea;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .info-item {
            flex: 1;
            min-width: 200px;
        }
        
        .info-item h3 {
            color: #495057;
            font-size: 14px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .info-item p {
            color: #212529;
            font-size: 18px;
            font-weight: 600;
        }

        .selector-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-top: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .item-toggle {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: #f8f9fa;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .item-toggle:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .item-toggle input[type="checkbox"] {
            cursor: pointer;
        }

        .item-toggle.active {
            background: #667eea;
            color: white;
        }

        .item-toggle.hidden-item {
            background: #ffc107;
            color: #000;
        }

        /* Context Menu Styles */
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            min-width: 200px;
            overflow: hidden;
        }

        .context-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .context-menu-item:hover {
            background: #f8f9fa;
        }

        .context-menu-separator {
            height: 1px;
            background: #e9ecef;
            margin: 5px 0;
        }

        .hidden-rows-panel {
            padding: 15px;
            background: #fff3cd;
            border-top: 2px solid #ffc107;
        }

        .hidden-rows-panel h4 {
            margin-bottom: 10px;
            color: #856404;
        }

        .hidden-row-item {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: white;
            border-radius: 15px;
            margin: 3px;
            border: 1px solid #ffc107;
        }

        .hidden-row-item button {
            background: #28a745;
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            cursor: pointer;
        }

        .hidden-row-item button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –µ–ª–µ–∫—Ç—Ä–æ–º–æ–±—ñ–ª—ñ–≤</h1>
            <p>–£–∫—Ä–∞—ó–Ω–∞ 2025 ‚Ä¢ –ë—é–¥–∂–µ—Ç –¥–æ ‚Ç¨20,000</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="fileInput">üìÅ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ JSON:</label>
                <input type="file" id="fileInput" accept=".json">
            </div>
            
            <div class="control-group">
                <label for="baseModel">üéØ –ë–∞–∑–æ–≤–∞ –º–æ–¥–µ–ª—å:</label>
                <select id="baseModel">
                    <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è --</option>
                </select>
            </div>
            
            <button id="resetComparison" class="secondary">üîÑ –°–∫–∏–Ω—É—Ç–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è</button>
            <button id="toggleColumns">üìä –ö–æ–ª–æ–Ω–∫–∏</button>
            <button id="showHiddenRows">üëÅÔ∏è –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ä—è–¥–∫–∏</button>
        </div>

        <div id="columnSelector" class="selector-panel" style="display: none;"></div>
        
        <div id="hiddenRowsPanel" class="hidden-rows-panel" style="display: none;">
            <h4>–ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ –º–æ–¥–µ–ª—ñ:</h4>
            <div id="hiddenRowsList"></div>
        </div>
        
        <div id="loading" class="loading">
            –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ JSON —Ñ–∞–π–ª –¥–ª—è –ø–æ—á–∞—Ç–∫—É —Ä–æ–±–æ—Ç–∏...
        </div>
        
        <div id="ev-table"></div>
        
        <div id="infoPanel" class="info-panel" style="display: none;">
            <div class="info-item">
                <h3>–í—Å—å–æ–≥–æ –º–æ–¥–µ–ª–µ–π</h3>
                <p id="totalModels">-</p>
            </div>
            <div class="info-item">
                <h3>–í –º–µ–∂–∞—Ö –±—é–¥–∂–µ—Ç—É</h3>
                <p id="withinBudget">-</p>
            </div>
            <div class="info-item">
                <h3>–°–µ—Ä–µ–¥–Ω—è —Ü—ñ–Ω–∞</h3>
                <p id="avgPrice">-</p>
            </div>
            <div class="info-item">
                <h3>–î–µ–¥–ª–∞–π–Ω –ø–æ–¥–∞—Ç–∫—ñ–≤</h3>
                <p id="taxDeadline">-</p>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu" style="display: none;">
        <div class="context-menu-item" id="moveToTop">
            <span>‚¨ÜÔ∏è</span> –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫
        </div>
        <div class="context-menu-item" id="moveUp">
            <span>üîº</span> –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –≤–≥–æ—Ä—É
        </div>
        <div class="context-menu-item" id="moveDown">
            <span>üîΩ</span> –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –≤–Ω–∏–∑
        </div>
        <div class="context-menu-item" id="moveToBottom">
            <span>‚¨áÔ∏è</span> –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏ –≤ –∫—ñ–Ω–µ—Ü—å
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="hideRow">
            <span>üëÅÔ∏è‚Äçüó®Ô∏è</span> –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Ä—è–¥–æ–∫
        </div>
        <div class="context-menu-item" id="setAsBase">
            <span>üéØ</span> –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —è–∫ –±–∞–∑–æ–≤—É
        </div>
    </div>

    <!-- Tabulator JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.5.0/js/tabulator.min.js"></script>
    
    <script>
        let table;
        let evData = [];
        let baseModelData = null;
        let hiddenRows = [];
        let contextMenuRow = null;

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É —á–∏—Å–ª–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å –∑ —Ä—è–¥–∫—ñ–≤ —Ç–∏–ø—É "10-20" –∞–±–æ "10"
        function parseNumericValue(value) {
            if (!value) return null;
            const str = value.toString();
            const match = str.match(/[\d.]+/);
            return match ? parseFloat(match[0]) : null;
        }

        // –§—É–Ω–∫—Ü—ñ—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —á–∏—Å–ª–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å
        function compareNumeric(value, baseValue) {
            const num = parseNumericValue(value);
            const baseNum = parseNumericValue(baseValue);
            
            if (num === null || baseNum === null) return value;
            
            const diff = num - baseNum;
            const diffStr = diff > 0 ? `+${diff.toFixed(0)}` : diff.toFixed(0);
            const colorClass = diff > 0 ? 'positive-diff' : (diff < 0 ? 'negative-diff' : 'neutral-diff');
            
            return `${value} <span class="${colorClass}">(${diffStr})</span>`;
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞–±–ª–∏—Ü—ñ
        function initTable(data) {
            evData = data.electric_vehicles;
            
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ñ–æ-–ø–∞–Ω–µ–ª—ñ
            document.getElementById('totalModels').textContent = data.summary.total_models;
            document.getElementById('withinBudget').textContent = data.summary.models_within_budget;
            document.getElementById('avgPrice').textContent = data.summary.average_price_eur;
            document.getElementById('taxDeadline').textContent = data.summary.tax_deadline;
            document.getElementById('infoPanel').style.display = 'flex';
            document.getElementById('loading').style.display = 'none';
            
            // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Å–µ–ª–µ–∫—Ç—É –±–∞–∑–æ–≤–∏—Ö –º–æ–¥–µ–ª–µ–π
            const baseModelSelect = document.getElementById('baseModel');
            baseModelSelect.innerHTML = '<option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è --</option>';
            evData.forEach((vehicle, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = vehicle.model;
                baseModelSelect.appendChild(option);
            });
            
            // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∫–æ–ª–æ–Ω–æ–∫
            const columns = [
                {title: "–ú–æ–¥–µ–ª—å", field: "model", frozen: true, width: 200, headerFilter: "input"},
                {title: "–•—ñ–º—ñ—è –±–∞—Ç–∞—Ä–µ—ó", field: "battery_chemistry", width: 150},
                {title: "–Ñ–º–Ω—ñ—Å—Ç—å (–∫–í—Ç¬∑–≥–æ–¥)", field: "battery_capacity_kwh", width: 150, sorter: "number"},
                {title: "–ó–∞–ø–∞—Å WLTP (–∫–º)", field: "range_wltp_km", width: 150},
                {title: "–†–µ–∞–ª—å–Ω–∏–π –∑–∞–ø–∞—Å (–∫–º)", field: "range_real_km", width: 150},
                {title: "–ó–∞—Ä—è–¥ 0-100% (–≥–æ–¥)", field: "charge_0_100_hours", width: 150},
                {title: "–ó–∞—Ä—è–¥ 10-80% (—Ö–≤)", field: "charge_10_80_minutes", width: 150},
                {title: "DC –º–∞–∫—Å (–∫–í—Ç)", field: "dc_charging_max_kw", width: 120},
                {title: "AC –º–∞–∫—Å (–∫–í—Ç)", field: "ac_charging_max_kw", width: 120},
                {title: "–ö–ª—ñ—Ä–µ–Ω—Å (–º–º)", field: "ground_clearance_mm", width: 120, formatter: function(cell) {
                    const value = cell.getValue();
                    const row = cell.getRow().getData();
                    if (row.clearance_requirement_met) {
                        return `<span style="color: #28a745">‚úì ${value}</span>`;
                    } else {
                        return `<span style="color: #dc3545">‚úó ${value}</span>`;
                    }
                }},
                {title: "–ü–æ—Ä—Ç –∑–∞—Ä—è–¥–∫–∏", field: "charging_port", width: 150},
                {title: "–¢–µ—Ä–º–æ–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç", field: "thermal_management", width: 150},
                {title: "–†–æ–∫–∏ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞", field: "production_years", width: 150},
                {title: "–î–æ–≤–∂–∏–Ω–∞ (–º–º)", field: "length_mm", width: 120},
                {title: "–®–∏—Ä–∏–Ω–∞ (–º–º)", field: "width_mm", width: 120},
                {title: "–ö–ª–∞—Å", field: "vehicle_class", width: 150},
                {title: "–¶—ñ–Ω–∞ –Ω–æ–≤–∞ (‚Ç¨)", field: "price_new_eur", width: 150},
                {title: "–¶—ñ–Ω–∞ –±/–≤ –£–∫—Ä–∞—ó–Ω–∞ (‚Ç¨)", field: "price_used_ukraine_eur", width: 180, headerFilter: "input"},
                {title: "–û–±'—î–º –±–∞–≥–∞–∂–Ω–∏–∫–∞ (–ª)", field: "trunk_volume_l", width: 150},
                {title: "–ü—Ä–∏–º—ñ—Ç–∫–∏", field: "notes", width: 300, formatter: "textarea"}
            ];
            
            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
            table = new Tabulator("#ev-table", {
                data: evData,
                layout: "fitDataFill",
                columns: columns,
                movableColumns: true,
                resizableColumns: true,
                pagination: "local",
                paginationSize: 50,
                paginationSizeSelector: [10, 20, 50, 100],
                height: "600px",
                rowFormatter: function(row) {
                    if (baseModelData && row.getData().model === baseModelData.model) {
                        row.getElement().classList.add("base-model-row");
                    }
                },
                rowContextMenu: function(e, row) {
                    e.preventDefault();
                    contextMenuRow = row;
                    showContextMenu(e.clientX, e.clientY);
                }
            });

            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫
            createColumnSelector(columns);
        }

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫
        function createColumnSelector(columns) {
            const selector = document.getElementById('columnSelector');
            selector.innerHTML = '<strong>–ü–æ–∫–∞–∑–∞—Ç–∏/–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏:</strong><br>';
            
            columns.forEach(col => {
                const toggle = document.createElement('label');
                toggle.className = 'item-toggle active';
                toggle.innerHTML = `
                    <input type="checkbox" checked data-field="${col.field}">
                    <span>${col.title}</span>
                `;
                
                toggle.querySelector('input').addEventListener('change', function() {
                    if (this.checked) {
                        table.showColumn(col.field);
                        toggle.classList.add('active');
                    } else {
                        table.hideColumn(col.field);
                        toggle.classList.remove('active');
                    }
                });
                
                selector.appendChild(toggle);
            });
        }

        // –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –±–∞–∑–æ–≤–æ—é –º–æ–¥–µ–ª–ª—é
        function compareWithBase(baseIndex) {
            if (baseIndex === '') {
                table.replaceData(evData.filter(v => !hiddenRows.includes(v.model)));
                baseModelData = null;
                return;
            }
            
            baseModelData = evData[baseIndex];
            const comparisonData = evData.filter(v => !hiddenRows.includes(v.model)).map(vehicle => {
                if (vehicle.model === baseModelData.model) {
                    return vehicle;
                }
                
                const compared = {...vehicle};
                
                // –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤—Å—ñ—Ö —á–∏—Å–ª–æ–≤–∏—Ö –ø–æ–ª—ñ–≤
                const numericFields = [
                    'battery_capacity_kwh', 
                    'ground_clearance_mm', 
                    'dc_charging_max_kw', 
                    'ac_charging_max_kw',
                    'length_mm',
                    'width_mm',
                    'trunk_volume_l',
                    'charge_0_100_hours',
                    'charge_10_80_minutes'
                ];
                
                numericFields.forEach(field => {
                    if (vehicle[field] && baseModelData[field]) {
                        compared[field] = compareNumeric(vehicle[field], baseModelData[field]);
                    }
                });
                
                // –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ–≤ (range)
                if (vehicle.range_wltp_km && baseModelData.range_wltp_km) {
                    compared.range_wltp_km = compareNumeric(vehicle.range_wltp_km, baseModelData.range_wltp_km);
                }
                
                if (vehicle.range_real_km && baseModelData.range_real_km) {
                    compared.range_real_km = compareNumeric(vehicle.range_real_km, baseModelData.range_real_km);
                }
                
                return compared;
            });
            
            table.replaceData(comparisonData);
            table.redraw();
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é
        function showContextMenu(x, y) {
            const menu = document.getElementById('contextMenu');
            menu.style.display = 'block';
            menu.style.left = x + 'px';
            menu.style.top = y + 'px';
        }

        // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é
        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
        }

        // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Ä—è–¥–æ–∫
        function hideRow(model) {
            if (!hiddenRows.includes(model)) {
                hiddenRows.push(model);
                updateHiddenRowsPanel();
                if (baseModelData) {
                    compareWithBase(evData.findIndex(v => v.model === baseModelData.model));
                } else {
                    table.replaceData(evData.filter(v => !hiddenRows.includes(v.model)));
                }
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä—è–¥–æ–∫
        function showRow(model) {
            hiddenRows = hiddenRows.filter(m => m !== model);
            updateHiddenRowsPanel();
            if (baseModelData) {
                compareWithBase(evData.findIndex(v => v.model === baseModelData.model));
            } else {
                table.replaceData(evData.filter(v => !hiddenRows.includes(v.model)));
            }
        }

        // –û–Ω–æ–≤–∏—Ç–∏ –ø–∞–Ω–µ–ª—å –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤
        function updateHiddenRowsPanel() {
            const panel = document.getElementById('hiddenRowsPanel');
            const list = document.getElementById('hiddenRowsList');
            
            if (hiddenRows.length > 0) {
                panel.style.display = 'block';
                list.innerHTML = '';
                hiddenRows.forEach(model => {
                    const item = document.createElement('span');
                    item.className = 'hidden-row-item';
                    item.innerHTML = `
                        ${model}
                        <button onclick="showRow('${model.replace(/'/g, "\\'")}')">–ü–æ–∫–∞–∑–∞—Ç–∏</button>
                    `;
                    list.appendChild(item);
                });
            } else {
                panel.style.display = 'none';
            }
        }

        // –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è —Ä—è–¥–∫—ñ–≤
        function moveRowToTop() {
            const row = contextMenuRow;
            if (row) {
                row.move(1);
            }
        }

        function moveRowUp() {
            const row = contextMenuRow;
            if (row) {
                row.movePrev();
            }
        }

        function moveRowDown() {
            const row = contextMenuRow;
            if (row) {
                row.moveNext();
            }
        }

        function moveRowToBottom() {
            const row = contextMenuRow;
            if (row) {
                const rows = table.getRows();
                row.move(rows.length);
            }
        }

        // –ü–æ–¥—ñ—ó –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        document.getElementById('moveToTop').addEventListener('click', () => {
            moveRowToTop();
            hideContextMenu();
        });

        document.getElementById('moveUp').addEventListener('click', () => {
            moveRowUp();
            hideContextMenu();
        });

        document.getElementById('moveDown').addEventListener('click', () => {
            moveRowDown();
            hideContextMenu();
        });

        document.getElementById('moveToBottom').addEventListener('click', () => {
            moveRowToBottom();
            hideContextMenu();
        });

        document.getElementById('hideRow').addEventListener('click', () => {
            if (contextMenuRow) {
                hideRow(contextMenuRow.getData().model);
            }
            hideContextMenu();
        });

        document.getElementById('setAsBase').addEventListener('click', () => {
            if (contextMenuRow) {
                const model = contextMenuRow.getData().model;
                const index = evData.findIndex(v => v.model === model);
                document.getElementById('baseModel').value = index;
                compareWithBase(index);
            }
            hideContextMenu();
        });

        // –ó–∞–∫—Ä–∏—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
        document.addEventListener('click', hideContextMenu);
        document.getElementById('contextMenu').addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // –û–±—Ä–æ–±–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        initTable(data);
                    } catch (error) {
                        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —á–∏—Ç–∞–Ω–Ω—ñ JSON —Ñ–∞–π–ª—É: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        });

        // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É –±–∞–∑–æ–≤–æ—ó –º–æ–¥–µ–ª—ñ
        document.getElementById('baseModel').addEventListener('change', function(e) {
            compareWithBase(e.target.value);
        });

        // –°–∫–∏–¥–∞–Ω–Ω—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
        document.getElementById('resetComparison').addEventListener('click', function() {
            document.getElementById('baseModel').value = '';
            compareWithBase('');
        });

        // –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–ª–æ–Ω–æ–∫
        document.getElementById('toggleColumns').addEventListener('click', function() {
            const selector = document.getElementById('columnSelector');
            selector.style.display = selector.style.display === 'none' ? 'block' : 'none';
        });

        // –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ä—è–¥–∫–∏
        document.getElementById('showHiddenRows').addEventListener('click', function() {
            const panel = document.getElementById('hiddenRowsPanel');
            if (hiddenRows.length > 0) {
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            } else {
                alert('–ù–µ–º–∞—î –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤');
            }
        });

        // –ó—Ä–æ–±–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.showRow = showRow;

        // –°–ø—Ä–æ–±–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª—É
        fetch('ukraine_ev_database_2025.json')
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('–§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
            })
            .then(data => {
                initTable(data);
            })
            .catch(() => {
                console.log('–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è –≤–∏–±–æ—Ä—É JSON —Ñ–∞–π–ª—É');
            });
    </script>
</body>
</html>